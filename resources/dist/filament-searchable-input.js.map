{"version":3,"file":"filament-searchable-input.js","sources":["../js/components/searchable-input.js"],"sourcesContent":["// noinspection JSUnusedGlobalSymbols,JSUnresolvedReference\n\nexport default function searchableInput({key, statePath, tableMode = false, columns = [], perPage = 10, wire, initialValue, displayValueKey = 'value'}) {\n    if (tableMode) {\n        return tableInput({key, statePath, columns, perPage, wire, displayValueKey})\n    }\n    return listInput({key, statePath, wire, displayValueKey})\n}\n\n/**\n * Extract a string value from a potentially complex value\n */\nfunction extractStringValue(value, displayValueKey = 'value') {\n    if (value === null || value === undefined) {\n        return ''\n    }\n    if (typeof value === 'string') {\n        return value\n    }\n    if (typeof value === 'number') {\n        return String(value)\n    }\n    if (typeof value === 'object') {\n        if (value[displayValueKey] !== undefined) {\n            return String(value[displayValueKey])\n        }\n        if (value.value !== undefined) {\n            return String(value.value)\n        }\n        if (value.label !== undefined) {\n            return String(value.label)\n        }\n    }\n    return ''\n}\n\nfunction listInput({key, statePath, wire, displayValueKey}) {\n    return {\n        previous_value: null,\n        suggestions: [],\n        selected_suggestion: 0,\n\n        // Use entanglement for proper Livewire sync\n        init() {\n            // Create entangled binding\n            this._entangled = wire.entangle(statePath)\n\n            // Set initial display value from entangled state\n            const initialValue = extractStringValue(this._entangled, displayValueKey)\n            this.value = initialValue\n            this.previous_value = initialValue\n\n            // Watch for external changes to the entangled value\n            this.$watch('_entangled', (newValue) => {\n                this.value = extractStringValue(newValue, displayValueKey)\n            })\n        },\n\n        get value() {\n            return this._displayValue ?? ''\n        },\n\n        set value(val) {\n            this._displayValue = val\n        },\n\n        refresh_suggestions() {\n            if (this.value === this.previous_value) {\n                return\n            }\n\n            if (!this.value) {\n                this.suggestions = []\n                this.previous_value = null\n                return\n            }\n\n            this.previous_value = this.value\n\n            wire.callSchemaComponentMethod(key, 'getSearchResultsForJs', { search: this.value })\n                .then(response => {\n                    this.suggestions = response\n                    this.selected_suggestion = 0\n                })\n        },\n\n        set(item) {\n            if (item === undefined) {\n                return\n            }\n\n            const stringValue = extractStringValue(item, displayValueKey)\n            this.value = stringValue\n            this._entangled = stringValue  // Sync to Livewire\n            this.suggestions = []\n\n            wire.callSchemaComponentMethod(key, 'reactOnItemSelectedFromJs', { item: item })\n        },\n\n        previous_suggestion() {\n            this.selected_suggestion--\n\n            if (this.selected_suggestion < 0) {\n                this.selected_suggestion = 0\n            }\n        },\n\n        next_suggestion() {\n            this.selected_suggestion++\n\n            if (this.selected_suggestion > this.suggestions.length - 1) {\n                this.selected_suggestion = this.suggestions.length - 1\n            }\n        },\n    }\n}\n\nfunction tableInput({key, statePath, columns, perPage, wire, displayValueKey}) {\n    return {\n        previous_value: null,\n        showTable: false,\n        tableData: {\n            results: [],\n            total: 0,\n            perPage: perPage,\n            page: 1,\n        },\n        selectedIndex: 0,\n        sortColumn: null,\n        sortDirection: 'asc',\n        pageInput: '',\n        isLoading: false,\n\n        // Use entanglement for proper Livewire sync\n        init() {\n            // Create entangled binding\n            this._entangled = wire.entangle(statePath)\n\n            // Set initial display value from entangled state\n            const initialValue = extractStringValue(this._entangled, displayValueKey)\n            this.value = initialValue\n            this.previous_value = initialValue\n\n            // Watch for external changes to the entangled value\n            this.$watch('_entangled', (newValue) => {\n                this.value = extractStringValue(newValue, displayValueKey)\n            })\n        },\n\n        get value() {\n            return this._displayValue ?? ''\n        },\n\n        set value(val) {\n            this._displayValue = val\n        },\n\n        refresh_table() {\n            if (this.value === this.previous_value) {\n                return\n            }\n\n            if (!this.value) {\n                this.tableData = { results: [], total: 0, perPage: perPage, page: 1 }\n                this.showTable = false\n                this.previous_value = null\n                return\n            }\n\n            this.previous_value = this.value\n            this.tableData.page = 1\n            this.selectedIndex = 0\n            this.pageInput = ''\n            this.loadData()\n        },\n\n        loadData() {\n            this.isLoading = true\n            this.showTable = true\n\n            wire.callSchemaComponentMethod(key, 'getPaginatedSearchResultsForJs', {\n                search: this.value,\n                page: this.tableData.page,\n                sortColumn: this.sortColumn,\n                sortDirection: this.sortDirection,\n            }).then(response => {\n                this.tableData = response\n                this.isLoading = false\n\n                if (this.selectedIndex >= response.results.length) {\n                    this.selectedIndex = Math.max(0, response.results.length - 1)\n                }\n            })\n        },\n\n        sortBy(column) {\n            if (this.sortColumn === column) {\n                this.sortDirection = this.sortDirection === 'asc' ? 'desc' : 'asc'\n            } else {\n                this.sortColumn = column\n                this.sortDirection = 'asc'\n            }\n            this.loadData()\n        },\n\n        nextPage() {\n            const totalPages = Math.ceil(this.tableData.total / this.tableData.perPage)\n            if (this.tableData.page < totalPages) {\n                this.tableData.page++\n                this.selectedIndex = 0\n                this.pageInput = ''\n                this.loadData()\n            }\n        },\n\n        prevPage() {\n            if (this.tableData.page > 1) {\n                this.tableData.page--\n                this.selectedIndex = 0\n                this.pageInput = ''\n                this.loadData()\n            }\n        },\n\n        goToPageFromInput() {\n            const pageNum = parseInt(this.pageInput)\n            if (!pageNum || isNaN(pageNum)) {\n                this.pageInput = ''\n                return\n            }\n\n            const totalPages = Math.ceil(this.tableData.total / this.tableData.perPage)\n            const targetPage = Math.max(1, Math.min(pageNum, totalPages))\n\n            this.tableData.page = targetPage\n            this.selectedIndex = 0\n            this.pageInput = ''\n            this.loadData()\n        },\n\n        selectItem(item) {\n            if (!item) return\n\n            const stringValue = extractStringValue(item, displayValueKey)\n            this.value = stringValue\n            this._entangled = stringValue  // Sync to Livewire\n            this.showTable = false\n\n            wire.callSchemaComponentMethod(key, 'reactOnItemSelectedFromJs', { item: item })\n        },\n\n        selectCurrentOrFirst() {\n            if (this.tableData.results.length > 0 && this.selectedIndex >= 0) {\n                const item = this.tableData.results[this.selectedIndex]\n                this.selectItem(item)\n            }\n        },\n\n        handleAction(item, action) {\n            wire.callSchemaComponentMethod(key, 'reactOnRowActionFromJs', {\n                item: item,\n                action: action,\n            })\n        },\n\n        nextIndex() {\n            this.selectedIndex++\n            if (this.selectedIndex >= this.tableData.results.length) {\n                this.selectedIndex = this.tableData.results.length - 1\n            }\n        },\n\n        prevIndex() {\n            this.selectedIndex--\n            if (this.selectedIndex < 0) {\n                this.selectedIndex = 0\n            }\n        },\n    }\n}\n"],"names":["searchableInput","key","statePath","tableMode","columns","perPage","wire","initialValue","displayValueKey","tableInput","listInput","extractStringValue","value","newValue","val","response","item","stringValue","column","totalPages","pageNum","targetPage","action"],"mappings":"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"}