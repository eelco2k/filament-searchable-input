{"version":3,"file":"filament-searchable-input.js","sources":["../js/components/searchable-input.js"],"sourcesContent":["// noinspection JSUnusedGlobalSymbols,JSUnresolvedReference\n\nexport default function searchableInput({key, statePath, tableMode = false, columns = [], perPage = 10}) {\n    if (tableMode) {\n        return tableInput({key, statePath, columns, perPage})\n    }\n    return listInput({key, statePath})\n}\n\nfunction listInput({key, statePath}) {\n    return {\n        previous_value: null,\n        value: this.$wire.entangle(statePath),\n        suggestions: [],\n        selected_suggestion: 0,\n        refresh_suggestions: function() {\n            if (this.value === this.previous_value) {\n                return\n            }\n\n            if (!this.value) {\n                this.suggestions = []\n                this.previous_value = null\n                return\n            }\n\n            this.previous_value = this.value\n\n            // noinspection JSPotentiallyInvalidUsageOfThis\n            this.$wire.callSchemaComponentMethod(key, 'getSearchResultsForJs', { search: this.value })\n                .then(response => {\n                    this.suggestions = response\n                    this.selected_suggestion = 0\n                })\n        },\n        set: function(item) {\n            if (item === undefined) {\n                return\n            }\n\n            this.value = item.value\n            this.suggestions = []\n\n            // noinspection JSPotentiallyInvalidUsageOfThis\n            this.$wire.callSchemaComponentMethod(key, 'reactOnItemSelectedFromJs', { item: item })\n        },\n        previous_suggestion() {\n            this.selected_suggestion--\n\n            if (this.selected_suggestion < 0) {\n                this.selected_suggestion = 0\n            }\n        },\n        next_suggestion() {\n            this.selected_suggestion++\n\n            if (this.selected_suggestion > this.suggestions.length - 1) {\n                this.selected_suggestion = this.suggestions.length - 1\n            }\n        },\n    }\n}\n\nfunction tableInput({key, statePath, columns, perPage}) {\n    return {\n        previous_value: null,\n        value: this.$wire.entangle(statePath),\n        showTable: false,\n        tableData: {\n            results: [],\n            total: 0,\n            perPage: perPage,\n            page: 1,\n        },\n        selectedIndex: 0,\n        sortColumn: null,\n        sortDirection: 'asc',\n        pageInput: '',\n        isLoading: false,\n\n        refresh_table: function() {\n            if (this.value === this.previous_value) {\n                return\n            }\n\n            if (!this.value) {\n                this.tableData = { results: [], total: 0, perPage: perPage, page: 1 }\n                this.showTable = false\n                this.previous_value = null\n                return\n            }\n\n            this.previous_value = this.value\n            this.tableData.page = 1\n            this.selectedIndex = 0\n            this.pageInput = ''\n            this.loadData()\n        },\n\n        loadData: function() {\n            this.isLoading = true\n            this.showTable = true\n\n            // noinspection JSPotentiallyInvalidUsageOfThis\n            this.$wire.callSchemaComponentMethod(key, 'getPaginatedSearchResultsForJs', {\n                search: this.value,\n                page: this.tableData.page,\n                sortColumn: this.sortColumn,\n                sortDirection: this.sortDirection,\n            }).then(response => {\n                this.tableData = response\n                this.isLoading = false\n\n                // Adjust selected index if out of bounds\n                if (this.selectedIndex >= response.results.length) {\n                    this.selectedIndex = Math.max(0, response.results.length - 1)\n                }\n            })\n        },\n\n        sortBy: function(column) {\n            if (this.sortColumn === column) {\n                this.sortDirection = this.sortDirection === 'asc' ? 'desc' : 'asc'\n            } else {\n                this.sortColumn = column\n                this.sortDirection = 'asc'\n            }\n            this.loadData()\n        },\n\n        nextPage: function() {\n            const totalPages = Math.ceil(this.tableData.total / this.tableData.perPage)\n            if (this.tableData.page < totalPages) {\n                this.tableData.page++\n                this.selectedIndex = 0\n                this.pageInput = ''\n                this.loadData()\n            }\n        },\n\n        prevPage: function() {\n            if (this.tableData.page > 1) {\n                this.tableData.page--\n                this.selectedIndex = 0\n                this.pageInput = ''\n                this.loadData()\n            }\n        },\n\n        goToPageFromInput: function() {\n            const pageNum = parseInt(this.pageInput)\n            if (!pageNum || isNaN(pageNum)) {\n                this.pageInput = ''\n                return\n            }\n\n            const totalPages = Math.ceil(this.tableData.total / this.tableData.perPage)\n            const targetPage = Math.max(1, Math.min(pageNum, totalPages))\n\n            this.tableData.page = targetPage\n            this.selectedIndex = 0\n            this.pageInput = ''\n            this.loadData()\n        },\n\n        selectItem: function(item) {\n            if (!item) return\n\n            this.value = item.value\n            this.showTable = false\n\n            // noinspection JSPotentiallyInvalidUsageOfThis\n            this.$wire.callSchemaComponentMethod(key, 'reactOnItemSelectedFromJs', { item: item })\n        },\n\n        selectCurrentOrFirst: function() {\n            if (this.tableData.results.length > 0 && this.selectedIndex >= 0) {\n                const item = this.tableData.results[this.selectedIndex]\n                this.selectItem(item)\n            }\n        },\n\n        handleAction: function(item, action) {\n            // noinspection JSPotentiallyInvalidUsageOfThis\n            this.$wire.callSchemaComponentMethod(key, 'reactOnRowActionFromJs', {\n                item: item,\n                action: action,\n            })\n        },\n\n        nextIndex: function() {\n            this.selectedIndex++\n            if (this.selectedIndex >= this.tableData.results.length) {\n                this.selectedIndex = this.tableData.results.length - 1\n            }\n        },\n\n        prevIndex: function() {\n            this.selectedIndex--\n            if (this.selectedIndex < 0) {\n                this.selectedIndex = 0\n            }\n        },\n    }\n}\n"],"names":["searchableInput","key","statePath","tableMode","columns","perPage","tableInput","listInput","response","item","column","totalPages","pageNum","targetPage","action"],"mappings":"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"}